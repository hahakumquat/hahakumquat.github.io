function init(){var e=document.getElementById("container");e.setAttribute("style","width:90%"),e.setAttribute("style","height:90%"),WIDTH=window.innerWidth,HEIGHT=window.innerHeight,scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(30,WIDTH/HEIGHT,1e-4,1e3),camera.position.z=2.5,scene.add(camera);var a=new THREE.PointLight(16777215,1,1e4);a.position.set(1.1,1.1,1.1),scene.add(a);var a=new THREE.AmbientLight(12303291);scene.add(a),geom=new THREE.SphereGeometry(.5,100,100);var r=new THREE.TextureLoader,t=r.load("img/bg.jpg"),o=r.load("img/earthdiffuse.jpg"),n=r.load("img/earthalpha.jpg"),i=r.load("img/earthbump.jpg");mat=new THREE.MeshBasicMaterial({map:o,wireframe:!0}),mat2=new THREE.MeshPhongMaterial({map:o,bumpMap:i,bumpScale:.02,specularMap:n,opacity:.4,transparent:!0,specular:new THREE.Color("#111111")}),earth=new THREE.Mesh(geom,mat),earth2=new THREE.Mesh(geom,mat2),bg=new THREE.Mesh(new THREE.SphereGeometry(5),new THREE.MeshBasicMaterial({map:t,side:THREE.DoubleSide})),renderer=new THREE.WebGLRenderer,renderer.setSize(WIDTH,HEIGHT),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.enableDamping=!0,controls.dampingFactor=.25,controls.enableZoom=!0,document.addEventListener("click",disturb,!1),document.addEventListener("keydown",function(e){32==e.keyCode&&drawMap()},!1),e.appendChild(renderer.domElement),drawMap(),animate()}function drawMap(){rotation=group.rotation.y,setData(genData()),addToGroup()}function genData(){for(var e=[[37.7749,-122.4194]],a=0;a<5*Math.random()+10;a++)e.push([e[0],[360*Math.random()-180,360*Math.random()-180]]);return e}function addToGroup(){group=new THREE.Object3D,group.add(earth),group.add(earth2),group.add(bg),new Set(lines).forEach(function(e){group.add(e)}),new Set(balls).forEach(function(e){group.add(e)}),group.rotation.y=rotation,scene.add(group)}function disturb(e){mouse.x=e.clientX/WIDTH*2-1,mouse.y=e.clientY/HEIGHT*-2+1,raycaster.setFromCamera(mouse,camera);var a=raycaster.intersectObjects(balls),r=new THREE.Color(MARKCOLOR),t=new THREE.Color(HIGHLIGHT),o=new THREE.Color(ROOTCOLOR);if(a.length>0){var n=a[0].object;n.material.color.b!==t&&(balls.forEach(function(e){e.position.x==rootMesh.position.x&&e.position.y==rootMesh.position.y&&e.position.z==rootMesh.position.z?e.material.color=o:e.material.color=r}),n.material.color=t)}}function setData(e){clearData(),renderData(e)}function clearData(){lines.forEach(function(e){scene.remove(e)}),lines=[],balls.forEach(function(e){scene.remove(e)}),balls=[],scene.remove(group)}function renderData(e){if(console.log(e),e.forEach(function(e){var a=latLongToVector3(e[0][0],e[0][1],.5,0),r=latLongToVector3(e[1][0],e[1][1],.5,0);new THREE.Vector3(a.x-r.x,a.y-r.y,a.z-r.z);makeLink(a,r,DOTSIZE,ELEVATION,LINEWIDTH)}),0!=e.length){var a=latLongToVector3(e[0][0],e[0][1],.5,0);rootMesh=mark(a.x,a.y,a.z,.03),rootMesh.material.color=new THREE.Color(ROOTCOLOR),rootMesh.material.transparent=!1,balls.push(rootMesh)}addToGroup()}function makeLink(e,a,r,t,o){var n=r*Math.random()*2+.02;balls.push(mark(a.x,a.y,a.z,n));for(var i=0;i<500*n;i++)lines.push(draw(e,a,t*Math.random()+.5,o))}function draw(e,a,r,t){var o=new THREE.Vector3((e.x+a.x)/2,(e.y+a.y)/2,(e.z+a.z)/2),n=new THREE.Vector3(o.x*r,o.y*r,o.z*r),i=new THREE.QuadraticBezierCurve3(e,n,a),s=new THREE.CurvePath;s.add(i);var c=new THREE.LineBasicMaterial({color:LINECOLOR,linewidth:t});return new THREE.Line(s.createPointsGeometry(20),c)}function mark(e,a,r,t){var o=new THREE.SphereGeometry(t,20,20),n=new THREE.MeshLambertMaterial({color:MARKCOLOR,transparent:!0,opacity:.3}),i=new THREE.Mesh(o,n);return i.position.set(e,a,r),i}function latLongToVector3(e,a,r,t){var o=e*Math.PI/180,n=(a-180)*Math.PI/180,i=-(r+t)*Math.cos(o)*Math.cos(n),s=(r+t)*Math.sin(o),c=(r+t)*Math.cos(o)*Math.sin(n);return new THREE.Vector3(i,s,c)}function animate(){requestAnimationFrame(animate),group.rotation.y+=.002,renderer.render(scene,camera)}var WIDTH,HEIGHT,camera,renderer,scene,bg,earth,mat,mat2,geom,tex,ellipse,group=new THREE.Object3D,rootMesh,rotation,lines=[],balls=[],LINECOLOR=11206655,MARKCOLOR=16777215,ROOTCOLOR=4491519,HIGHLIGHT=255,DOTSIZE=.02,ELEVATION=2,LINEWIDTH=1,OFFSET=15,controls,raycaster=new THREE.Raycaster,mouse={};init();