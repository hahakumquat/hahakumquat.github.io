function initParticleMaterial(){}function basicMove(t,e){var i=_.particleSystem,a=i.points.geometry.attributes.position.array,r=3*e;a[r+0]+=t.x/100,a[r+1]+=t.y/100,a[r+2]+=t.z/100}function physicalMove(t,e,i,a){var r=_.particleSystem,o=r.points.geometry.attributes.position.array,s=(r.points.geometry.attributes.velocity.array,i[2*a+0]-i[2*a+1]),n=r.position.x+r.wind.x*s+t.x*s+.5*r.gravity.x*s*s,p=r.position.y+r.wind.y*s+t.y*s+.5*r.gravity.y*s*s,y=r.position.z+r.wind.z*s+t.z*s+.5*r.gravity.z*s*s;o[3*a+0]=n,o[3*a+1]=p,o[3*a+2]=y}ParticleSystem=function(t){var e=this;e.time=new THREE.Clock(!0),e.position=t.position||new THREE.Vector3(0,-30,0),e.maxParticles=t.maxParticles||1e3,e.numParticles=e.maxParticles/2,e.lifetime=t.lifetime||5,e.size=t.size||1,e.speed=t.speed||40,e.spread=t.spread||20,e.physics=t.physics||!1,e.gravity=t.gravity||new THREE.Vector3(0,-10,0),e.wind=t.wind||new THREE.Vector3(0,0,0);for(var i=new THREE.BufferGeometry,a=new Float32Array(3*e.maxParticles),r=new Float32Array(3*e.maxParticles),o=new Float32Array(2*e.maxParticles),s=0;s<e.maxParticles;s++){a[3*s+0]=e.position.x,a[3*s+1]=e.position.y,a[3*s+2]=e.position.z;var n=2*Math.random()*Math.PI,p=Math.random()*Math.PI/4+Math.PI/4;r[3*s+0]=Math.cos(n),r[3*s+2]=Math.sin(n),r[3*s+1]=Math.tan(p),o[2*s+0]=Math.random()*e.lifetime,o[2*s+1]=o[2*s+0]}var y=new THREE.BufferAttribute(a,3);y.setDynamic(!0),i.addAttribute("position",y);var c=new THREE.BufferAttribute(r,1);c.setDynamic(!1),i.addAttribute("velocity",c);var d=new THREE.BufferAttribute(o,2);d.setDynamic(!0),i.addAttribute("life",d);var l=new THREE.PointsMaterial({size:e.size,blending:THREE.AdditiveBlending,map:_.texture,transparent:!0,alphaTest:.5,depthTest:!1,depthWrite:!1}),m=new THREE.Points(i,l);e.points=m},ParticleSystem.prototype.update=function(){for(var t=this,e=t.time.getDelta(),i=t.points.geometry.attributes.position.array,a=t.points.geometry.attributes.velocity.array,r=t.points.geometry.attributes.life.array,o=0;o<t.numParticles;o++)if(i[3*o+0]!=NaN&&i[3*o+1]!=NaN&&i[3*o+2]!=NaN||(i[3*o+0]=t.position.x,i[3*o+1]=t.position.y,i[3*o+2]=t.position.z),r[2*o+1]-e<0)r[2*o+0]=Math.random()*t.lifetime,r[2*o+1]=r[2*o+0],i[3*o+0]=t.position.x,i[3*o+1]=t.position.y,i[3*o+2]=t.position.z;else{r[2*o+1]-=e;var s=new THREE.Vector3(a[3*o+0]*t.spread,a[3*o+1]*t.speed,a[3*o+2]*t.spread),n=new THREE.Vector3(i[3*o+0],i[3*o+1],i[3*o+2]);t.physics?physicalMove(s,n,r,o):basicMove(s,o)}t.points.geometry.attributes.position.needsUpdate=!0,t.points.geometry.attributes.life.needsUpdate=!0,_.texture.needsUpdate=!0,_.renderer.render(_.scene,_.camera)};