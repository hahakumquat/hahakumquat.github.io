function init(){initParameters(),initObjects()}function initParameters(){_.container=document.getElementById("container"),_.width=window.innerWidth,_.height=window.innerHeight,_.view_angle=45,_.aspect=_.width/_.height,_.near=.1,_.far=2e3,_.spread=30,_.speed=30,_.maxParticles=1e4,_.canvasParticle=!1,_.size=3,_.lifetime=5,_.physics=!0,_.gravity=new THREE.Vector3(0,-50,0),_.wind=new THREE.Vector3(0,0,0)}function initObjects(){_.scene=new THREE.Scene,_.camera=new THREE.PerspectiveCamera(_.view_angle,_.aspect,_.near,_.far),_.renderer=new THREE.WebGLRenderer,_.renderer.setSize(_.width,_.height),_.container.appendChild(_.renderer.domElement),_.controls=new THREE.OrbitControls(_.camera,_.renderer.domElement),_.controls.enableDamping=!0,_.controls.rotateSpeed=.2,_.controls.zoomSpeed=.5,_.controls.dampingFactor=.25,_.controls.enableZoom=!0,initBackground(),_.camera.position.z=100,_.camera.position.y=50,_.scene.add(_.camera),_.canvasParticle&&(_.canvas=document.createElement("canvas"),_.canvas.width=256,_.canvas.height=256,_.ctx=_.canvas.getContext("2d"),_.texture=new THREE.Texture(_.canvas),document.body.appendChild(_.canvas)),_.particleSystem=new ParticleSystem(_),_.scene.add(_.particleSystem.points),initGUI()}function initGUI(){_.gui=new dat.GUI;var e=_.gui.addFolder("Particle Emitter"),a=_.gui.addFolder("Particle"),t=_.gui.addFolder("Physics"),i=_.gui.addFolder("Camera"),n=e.add(_.particleSystem,"numParticles",0,_.maxParticles);e.add(_.particleSystem,"spread",0,100),e.add(_.particleSystem,"speed",0,100),n.onChange(function(e){_.particleSystem.numParticles=Math.floor(e),positions=_.particleSystem.points.geometry.attributes.position.array;for(var a=_.particleSystem.numParticles;a<_.maxParticles;a++)positions[3*a+0]=NaN,positions[3*a+1]=NaN,positions[3*a+2]=NaN});a.add(_.particleSystem.points.material,"size",1,10),a.add(_.particleSystem,"lifetime",0,10);t.add(_.particleSystem,"physics",!0,!1);var r=t.addFolder("Gravity");r.add(_.gravity,"x"),r.add(_.gravity,"y"),r.add(_.gravity,"z");var d=t.addFolder("Wind");d.add(_.wind,"x"),d.add(_.wind,"y"),d.add(_.wind,"z");var c=i.add(_.camera,"near",.1,100),o=i.add(_.camera,"far",100,1e4),s=i.add(_.camera,"fov",0,100);c.onChange(function(){_.camera.updateProjectionMatrix()}),o.onChange(function(){_.camera.updateProjectionMatrix()}),s.onChange(function(){_.camera.updateProjectionMatrix()})}function initBackground(){var e=new THREE.PointLight(16777215,1,1e3);e.position.set(0,70,-200);var a=new THREE.Mesh(new THREE.SphereGeometry(1e3,50,50),new THREE.MeshLambertMaterial({color:11184810,side:THREE.BackSide}));_.scene.add(e),_.scene.add(a)}function animate(){_.controls.update(),_.canvasParticle&&drawCanvas(),updateGUI(),_.particleSystem.update(),_.renderer.render(_.scene,_.camera),requestAnimationFrame(animate)}function drawCanvas(){_.ctx.fillRect(0,0,256,256);var e=_.canvas.width/2,a=_.canvas.height/2,t=.4*e;_.ctx.arc(-e,-a,t,0,2*Math.PI),_.ctx.shadowColor="#010890",_.ctx.shadowBlur=200,_.ctx.shadowOffsetX=2*e,_.ctx.shadowOffsetY=2*a,_.ctx.fill()}function updateGUI(){}var _;$(document).ready(function(){(new THREE.TextureLoader).load("img/particle.png",function(e){_={},_.texture=e,init(),animate()}),window.addEventListener("resize",function(){_.width=window.innerWidth,_.height=window.innerHeight,_.aspect=_.width/_.height,_.camera.aspect=_.aspect,_.camera.updateProjectionMatrix(),_.renderer.setSize(_.width,_.height)}),$(window).blur(function(){_.particleSystem.time.start()}),$(window).focus(function(){_.particleSystem.time.stop()})});